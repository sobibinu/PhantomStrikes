{% extends "base.html" %}

{% block title %}PhantomStrike - Start a New Scan{% endblock %}

{% block head %}
<style>
    .scan-card {
        transition: transform 0.3s ease;
    }
    .scan-card:hover {
        transform: translateY(-5px);
    }
    
    .scan-options {
        display: none;
    }
    
    .scan-options.active {
        display: block;
    }
</style>
{% endblock %}

{% block content %}
<div class="container mx-auto">
    <!-- Page Header -->
    <div class="flex flex-col md:flex-row justify-between items-center mb-8">
        <div>
            <h1 class="text-3xl font-bold text-white">New Vulnerability Scan</h1>
            <p class="text-gray-400 mt-2">Configure and start a new security scan</p>
        </div>
        {% if current_user.is_authenticated %}
        <div class="mt-4 md:mt-0">
            <a href="{{ url_for('main.dashboard') }}" class="bg-phantom-secondary hover:bg-gray-700 text-white font-medium py-2 px-4 rounded-md transition duration-300">
                <i class="fas fa-arrow-left mr-1"></i> Back to Dashboard
            </a>
        </div>
        {% endif %}
    </div>

    <!-- Main Content -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
        <!-- Scan Configuration Form -->
        <div class="md:col-span-2">
            <div class="bg-phantom-secondary rounded-lg shadow-md p-6">
                <h2 class="text-xl font-semibold mb-6 text-white">Scan Configuration</h2>
                
                <form id="scanForm" method="POST" action="{{ url_for('main.scan') }}">
                    <!-- Target URL -->
                    <div class="mb-6">
                        <label for="target_url" class="block text-gray-300 text-sm font-medium mb-2">Target URL</label>
                        <div class="flex">
                            <input type="url" id="target_url" name="target_url" required
                                class="flex-grow shadow-sm rounded-l-md bg-phantom-primary border-gray-700 text-white focus:ring-phantom-accent focus:border-phantom-accent block w-full sm:text-sm border-2 p-2"
                                placeholder="https://example.com">
                            <button type="button" id="validateUrl" class="bg-phantom-primary border-2 border-gray-700 border-l-0 px-3 rounded-r-md text-gray-400 hover:text-phantom-accent">
                                <i class="fas fa-check"></i>
                            </button>
                        </div>
                        <p class="mt-1 text-sm text-gray-400">
                            Enter the complete URL of the target you want to scan
                        </p>
                    </div>

                    <!-- Scan Type Selection -->
                    <div class="mb-6">
                        <label class="block text-gray-300 text-sm font-medium mb-2">Scan Type</label>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                            <!-- Light Scan -->
                            <div class="relative">
                                <input type="radio" id="scan_light" name="scan_type" value="light" class="sr-only" checked>
                                <label for="scan_light" class="scan-card cursor-pointer block border-2 border-gray-700 rounded-lg p-4 bg-phantom-primary hover:border-phantom-accent">
                                    <div class="flex flex-col items-center">
                                        <div class="p-2 rounded-full bg-blue-900 bg-opacity-50 mb-3">
                                            <i class="fas fa-tachometer-alt text-blue-400"></i>
                                        </div>
                                        <span class="font-medium text-white">Light Scan</span>
                                        <span class="text-xs text-gray-400 mt-1">Basic vulnerabilities check</span>
                                    </div>
                                </label>
                            </div>
                            
                            <!-- Medium Scan (Authenticated Only) -->
                            <div class="relative {% if not current_user.is_authenticated %}opacity-50{% endif %}">
                                <input type="radio" id="scan_medium" name="scan_type" value="medium" class="sr-only" {% if not current_user.is_authenticated %}disabled{% endif %}>
                                <label for="scan_medium" class="scan-card cursor-pointer block border-2 border-gray-700 rounded-lg p-4 bg-phantom-primary hover:border-phantom-accent">
                                    <div class="flex flex-col items-center">
                                        <div class="p-2 rounded-full bg-yellow-800 bg-opacity-50 mb-3">
                                            <i class="fas fa-search-plus text-yellow-400"></i>
                                        </div>
                                        <span class="font-medium text-white">Medium Scan</span>
                                        <span class="text-xs text-gray-400 mt-1">Extended vulnerability check</span>
                                    </div>
                                    {% if not current_user.is_authenticated %}
                                    <div class="absolute inset-0 bg-phantom-primary bg-opacity-70 flex items-center justify-center rounded-lg">
                                        <div class="text-center p-2">
                                            <i class="fas fa-lock text-phantom-accent mb-1"></i>
                                            <span class="text-xs text-white block">Requires auth</span>
                                        </div>
                                    </div>
                                    {% endif %}
                                </label>
                            </div>
                            
                            <!-- Deep Scan (Authenticated Only) -->
                            <div class="relative {% if not current_user.is_authenticated %}opacity-50{% endif %}">
                                <input type="radio" id="scan_deep" name="scan_type" value="deep" class="sr-only" {% if not current_user.is_authenticated %}disabled{% endif %}>
                                <label for="scan_deep" class="scan-card cursor-pointer block border-2 border-gray-700 rounded-lg p-4 bg-phantom-primary hover:border-phantom-accent">
                                    <div class="flex flex-col items-center">
                                        <div class="p-2 rounded-full bg-red-900 bg-opacity-50 mb-3">
                                            <i class="fas fa-biohazard text-red-400"></i>
                                        </div>
                                        <span class="font-medium text-white">Deep Scan</span>
                                        <span class="text-xs text-gray-400 mt-1">Comprehensive security audit</span>
                                    </div>
                                    {% if not current_user.is_authenticated %}
                                    <div class="absolute inset-0 bg-phantom-primary bg-opacity-70 flex items-center justify-center rounded-lg">
                                        <div class="text-center p-2">
                                            <i class="fas fa-lock text-phantom-accent mb-1"></i>
                                            <span class="text-xs text-white block">Requires auth</span>
                                        </div>
                                    </div>
                                    {% endif %}
                                </label>
                            </div>
                            
                            <!-- Network Scan (Authenticated Only) -->
                            <div class="relative {% if not current_user.is_authenticated %}opacity-50{% endif %}">
                                <input type="radio" id="scan_network" name="scan_type" value="network" class="sr-only" {% if not current_user.is_authenticated %}disabled{% endif %}>
                                <label for="scan_network" class="scan-card cursor-pointer block border-2 border-gray-700 rounded-lg p-4 bg-phantom-primary hover:border-phantom-accent">
                                    <div class="flex flex-col items-center">
                                        <div class="p-2 rounded-full bg-purple-900 bg-opacity-50 mb-3">
                                            <i class="fas fa-network-wired text-purple-400"></i>
                                        </div>
                                        <span class="font-medium text-white">Network Scan</span>
                                        <span class="text-xs text-gray-400 mt-1">Port scanning & network analysis</span>
                                    </div>
                                    {% if not current_user.is_authenticated %}
                                    <div class="absolute inset-0 bg-phantom-primary bg-opacity-70 flex items-center justify-center rounded-lg">
                                        <div class="text-center p-2">
                                            <i class="fas fa-lock text-phantom-accent mb-1"></i>
                                            <span class="text-xs text-white block">Requires auth</span>
                                        </div>
                                    </div>
                                    {% endif %}
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Scan Options (collapsible based on scan type) -->
                    <div id="lightScanOptions" class="scan-options active mb-6">
                        <div class="border border-gray-700 rounded-md p-4 bg-phantom-primary">
                            <h3 class="text-sm font-medium text-gray-300 mb-3">Light Scan Options</h3>
                            <p class="text-sm text-gray-400 mb-3">
                                This scan checks for the most common vulnerabilities:
                            </p>
                            <ul class="text-sm text-gray-400 space-y-1 ml-6 list-disc">
                                <li>SQL Injection</li>
                                <li>Cross-Site Scripting (XSS)</li>
                                <li>Cross-Site Request Forgery (CSRF)</li>
                            </ul>
                            <div class="mt-3">
                                <p class="text-sm text-gray-400">
                                    Estimated scan time: 1-2 minutes
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <div id="mediumScanOptions" class="scan-options mb-6">
                        <div class="border border-gray-700 rounded-md p-4 bg-phantom-primary">
                            <h3 class="text-sm font-medium text-gray-300 mb-3">Medium Scan Options</h3>
                            <p class="text-sm text-gray-400 mb-3">
                                This scan includes light scan checks plus:
                            </p>
                            <ul class="text-sm text-gray-400 space-y-1 ml-6 list-disc">
                                <li>Local and Remote File Inclusion</li>
                                <li>Directory Traversal</li>
                                <li>Authentication Issues</li>
                                <li>Session Management</li>
                            </ul>
                            <div class="mt-3">
                                <p class="text-sm text-gray-400">
                                    Estimated scan time: 3-5 minutes
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <div id="deepScanOptions" class="scan-options mb-6">
                        <div class="border border-gray-700 rounded-md p-4 bg-phantom-primary">
                            <h3 class="text-sm font-medium text-gray-300 mb-3">Deep Scan Options</h3>
                            <p class="text-sm text-gray-400 mb-3">
                                Comprehensive scan including all checks from light and medium scans plus:
                            </p>
                            <ul class="text-sm text-gray-400 space-y-1 ml-6 list-disc">
                                <li>Security Misconfigurations</li>
                                <li>Sensitive Data Exposure</li>
                                <li>Insecure Direct Object References</li>
                                <li>Broken Access Controls</li>
                            </ul>
                            <div class="mt-3">
                                <p class="text-sm text-gray-400">
                                    Estimated scan time: 5-10 minutes
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <div id="networkScanOptions" class="scan-options mb-6">
                        <div class="border border-gray-700 rounded-md p-4 bg-phantom-primary">
                            <h3 class="text-sm font-medium text-gray-300 mb-3">Network Scan Options</h3>
                            <p class="text-sm text-gray-400 mb-3">
                                This scan performs port scanning and network analysis to identify open services and potential vulnerabilities.
                            </p>
                            <div class="mt-3 mb-3">
                                <label for="port_range" class="block text-sm font-medium text-gray-300 mb-1">Port Range</label>
                                <select id="port_range" name="custom_options" class="shadow-sm rounded-md bg-phantom-secondary border-gray-700 text-white focus:ring-phantom-accent focus:border-phantom-accent block w-full sm:text-sm border p-2">
                                    <option value="1-1000">Common Ports (1-1000)</option>
                                    <option value="1-65535">All Ports (1-65535)</option>
                                    <option value="21,22,23,25,53,80,110,139,443,445,3306,3389,8080">Common Services Only</option>
                                </select>
                            </div>
                            <p class="text-sm text-gray-400">
                                Estimated scan time: 3-5 minutes (may vary based on target and selected options)
                            </p>
                        </div>
                    </div>

                    <!-- Submission Button -->
                    <div class="flex justify-end">
                        <button type="submit" id="startScanButton" class="bg-phantom-accent hover:bg-teal-600 text-white font-bold py-2 px-6 rounded-md transition duration-300 flex items-center">
                            <i class="fas fa-play mr-2"></i> Start Scan
                        </button>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- Sidebar -->
        <div class="md:col-span-1">
            <!-- Scan Information -->
            <div class="bg-phantom-secondary rounded-lg shadow-md p-6 mb-6">
                <h3 class="text-lg font-semibold mb-4 text-white">Scan Information</h3>
                
                {% if current_user.is_authenticated %}
                <div class="border-l-4 border-phantom-accent pl-4 py-2 mb-4">
                    <p class="text-sm text-white">Authenticated User</p>
                    <p class="text-xs text-gray-400">Full scan options available</p>
                </div>
                {% else %}
                <div class="border-l-4 border-yellow-500 pl-4 py-2 mb-4">
                    <p class="text-sm text-white">Guest User</p>
                    <p class="text-xs text-gray-400">Limited to light scans only</p>
                </div>
                {% endif %}
                
                <div class="space-y-4">
                    <div>
                        <h4 class="text-sm font-medium text-gray-300">Before You Scan</h4>
                        <ul class="mt-2 text-sm text-gray-400 space-y-1 ml-6 list-disc">
                            <li>Ensure you have permission to scan the target</li>
                            <li>Some scans may trigger security systems</li>
                            <li>Network scans require proper authorization</li>
                        </ul>
                    </div>
                    
                    <div>
                        <h4 class="text-sm font-medium text-gray-300">Scan Limitations</h4>
                        <ul class="mt-2 text-sm text-gray-400 space-y-1 ml-6 list-disc">
                            <li>Results are not 100% guaranteed</li>
                            <li>Some vulnerabilities may be false positives</li>
                            <li>Deep scans take more time to complete</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <!-- Recent Scans (for authenticated users) -->
            {% if current_user.is_authenticated %}
            <div class="bg-phantom-secondary rounded-lg shadow-md p-6">
                <h3 class="text-lg font-semibold mb-4 text-white">Recent Scans</h3>
                <div id="recentScans">
                    <p class="text-sm text-gray-400 text-center py-3">
                        <i class="fas fa-spinner fa-spin mr-2"></i> Loading recent scans...
                    </p>
                </div>
            </div>
            {% else %}
            <!-- Sign Up CTA (for guests) -->
            <div class="bg-gradient-to-r from-phantom-primary to-phantom-secondary rounded-lg shadow-md p-6">
                <h3 class="text-lg font-semibold mb-4 text-white">Unlock Full Features</h3>
                <p class="text-sm text-gray-300 mb-4">
                    Sign up to access advanced scan types, detailed reports, and export functionality.
                </p>
                <a href="{{ url_for('auth.signup') }}" class="block w-full bg-phantom-accent hover:bg-teal-600 text-white text-center font-bold py-2 px-4 rounded-md transition duration-300">
                    Create Free Account
                </a>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/scan.js') }}"></script>
{% endblock %}
